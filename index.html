<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz de Im√°genes</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0f172a;color:#f1f5f9;display:flex;align-items:center;justify-content:center;padding:20px}
    .app{max-width:900px;width:100%;background:#1e293b;padding:20px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.4)}
    h1{margin-top:0}
    button{background:#6366f1;color:white;border:none;padding:8px 12px;border-radius:8px;margin:4px;cursor:pointer}
    button.ghost{background:#334155}
    .image-wrap{background:#0f172a;padding:10px;border-radius:8px;text-align:center;min-height:300px;display:flex;align-items:center;justify-content:center}
    .image-wrap img{max-width:100%;max-height:300px;object-fit:contain}
    .caption{margin-top:10px;padding:8px;border-radius:8px;background:#334155;text-align:center;min-height:40px}
    .caption.revealed{background:#22c55e;font-weight:bold}
    .toolbar{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
    .status{margin-top:10px;display:flex;justify-content:space-between;font-size:14px}
  </style>
</head>
<body>
  <div class="app">
    <h1>Quiz de Im√°genes</h1>
    <div>
      <div class="image-wrap" id="imageWrap">Cargando im√°genes‚Ä¶</div>
      <div class="caption" id="caption">‚Äî</div>
      <div class="toolbar">
        <button id="startBtn">Iniciar Quiz</button>
        <button id="startOverBtn" class="ghost">Reiniciar</button>
        <button id="revealBtn">Mostrar respuesta</button>
        <button id="pronounceBtn" class="ghost">Pronunciaci√≥n</button>
        <button id="nextBtn" class="ghost">Siguiente</button>
        <button id="correctBtn" class="ghost">Correcto</button>
        <button id="wrongBtn" class="ghost">Incorrecto</button>
      </div>
      <div class="status">
        <div id="progress">0 / 0</div>
        <div id="score">Puntaje: 0 / 0 (0%)</div>
        <div id="timer">00:00</div>
      </div>
    </div>
  </div>

<script>
let items=[], order=[], currentIndex=0, revealed=false;
let correct=0, intentos=0;
let timerInterval=null, startTime=null;

const imageWrap=document.getElementById("imageWrap");
const captionEl=document.getElementById("caption");
const revealBtn=document.getElementById("revealBtn");
const pronounceBtn=document.getElementById("pronounceBtn");
const nextBtn=document.getElementById("nextBtn");
const correctBtn=document.getElementById("correctBtn");
const wrongBtn=document.getElementById("wrongBtn");
const progressEl=document.getElementById("progress");
const scoreEl=document.getElementById("score");
const timerEl=document.getElementById("timer");

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}

function resetGame(){
  order=[];currentIndex=0;revealed=false;
  correct=0;intentos=0;
  stopTimer();
  timerEl.textContent="00:00";
  captionEl.textContent="‚Äî";captionEl.classList.remove("revealed");
  imageWrap.textContent="¬°Listo para empezar!";
  progressEl.textContent="0 / 0";
  scoreEl.textContent="Puntaje: 0 / 0 (0%)";
}

function render(){
  if(order.length===0) return;
  const idx=order[currentIndex], it=items[idx];
  imageWrap.innerHTML=`<img src="${it.src}" alt="">`;
  ocultarRespuesta();
  progressEl.textContent=`${currentIndex+1} / ${order.length}`;
}

function ocultarRespuesta(){revealed=false;captionEl.textContent="‚Äî";captionEl.classList.remove("revealed")}
function mostrarRespuesta(){const idx=order[currentIndex], it=items[idx];captionEl.textContent=it.caption;captionEl.classList.add("revealed");revealed=true}

function actualizarPuntaje(){const pct=intentos?Math.round(correct/intentos*100):0;scoreEl.textContent=`Puntaje: ${correct} / ${intentos} (${pct}%)`}

function siguienteImagen(){currentIndex++;if(currentIndex>=order.length){currentIndex=0;shuffle(order);}render()}

function iniciarTimer(){startTime=Date.now();timerInterval=setInterval(()=>{const diff=Math.floor((Date.now()-startTime)/1000);const m=String(Math.floor(diff/60)).padStart(2,"0");const s=String(diff%60).padStart(2,"0");timerEl.textContent=`${m}:${s}`;},1000)}
function stopTimer(){clearInterval(timerInterval);timerInterval=null}

document.getElementById("startBtn").onclick=()=>{
  resetGame();
  order=items.map((_,i)=>i);shuffle(order);currentIndex=0;
  render();iniciarTimer();
};

document.getElementById("startOverBtn").onclick=()=>resetGame();
revealBtn.onclick=()=>revealed?ocultarRespuesta():mostrarRespuesta();
nextBtn.onclick=()=>siguienteImagen();
correctBtn.onclick=()=>{if(!revealed)return;correct++;intentos++;actualizarPuntaje();siguienteImagen()};
wrongBtn.onclick=()=>{if(!revealed)return;intentos++;actualizarPuntaje();siguienteImagen()};

/* üîä Pronunciaci√≥n */
pronounceBtn.onclick=()=>{
  if(!revealed) return; // solo si ya se mostr√≥ la respuesta
  const idx=order[currentIndex], it=items[idx];
  // Obtener el nombre base del archivo de imagen
  const baseName=it.src.split("/").pop().split(".")[0];
  const audioPath=`audio/${baseName}.mp3`;
  const audio=new Audio(audioPath);
  audio.play().catch(err=>console.error("Error reproduciendo audio:", err));
};

resetGame();

/* üîΩ Carga autom√°tica del archivo images.json */
fetch("images.json")
  .then(res=>res.json())
  .then(data=>{
    items=data;
    imageWrap.textContent="¬°Im√°genes cargadas! Presiona Iniciar.";
  })
  .catch(err=>{
    imageWrap.textContent="‚ùå Error al cargar images.json";
    console.error(err);
  });
</script>
</body>
</html>
